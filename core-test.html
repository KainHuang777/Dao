<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/pixi.js@8.6.6/dist/pixi.min.js"></script>
    <title>æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1d;
            color: #e0e0e0;
        }

        #output {
            white-space: pre-wrap;
            background: #000;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .success {
            color: #4caf50;
        }

        .error {
            color: #f44336;
        }

        .info {
            color: #2196f3;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
        }

        button:hover {
            background: #45a049;
        }
    </style>
</head>

<body>
    <div id="pixi-container"
        style="position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; z-index:9999;"></div>
    <h1>éŠæˆ²æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦</h1>
    <div>
        <button id="testResources">æ¸¬è©¦è³‡æºç³»çµ±</button>
        <button id="testBuildings">æ¸¬è©¦å»ºç¯‰ç³»çµ±</button>
        <button id="testManualGather">æ¸¬è©¦æ‰‹å‹•æ¡é›†</button>
        <button id="testAutoGrow">æ¸¬è©¦è‡ªå‹•å¢é•·</button>
        <button id="testLifespanReset">æ¸¬è©¦å£½å…ƒå·²ç›¡é‡ç½®</button>
        <button id="testMaidSystem">æ¸¬è©¦ä¾å¥³è‡ªå‹•åˆæˆ</button>
        <button id="testTrainingTime">æ¸¬è©¦ä¿®ç…‰æ™‚é–“é¡¯ç¤º</button>
        <button id="testHintSystem">æ¸¬è©¦æç¤ºç³»çµ±ç‹€æ…‹</button>
        <button id="testTribulationReset">æ¸¬è©¦æ¸¡åŠ«é‡ç½®</button>
    </div>
    <div style="margin-top: 20px; padding: 10px; border: 1px solid #9c27b0; border-radius: 8px;">
        <h3 style="color: #ba68c8;">å®—é–€ç³»çµ±æ¸¬è©¦</h3>
        <button id="sectCheckUnlock" style="background: #ba68c8;">1. å‰å¾€ç¯‰åŸºæœŸ (è§£é–æ¸¬è©¦)</button>
        <button id="sectAddRes" style="background: #9c27b0;">2. æ·»åŠ è²¢ç»è³‡æº</button>
        <button id="sectContribute" style="background: #7b1fa2;">3. åŸ·è¡Œè²¢ç»</button>
        <button id="sectMaxLevel" style="background: #ab47bc;">4. å®—é–€æ»¿ç´š (LV5)</button>
        <button id="sectTaskTest" style="background: #8e24aa;">5. ä»»å‹™æµç¨‹æ¸¬è©¦ (åˆ·æ–°/æ¥å—/é ˜å–)</button>
        <button id="sectMarketTest" style="background: #2196f3;">6. é›²æµ·å¤©å¸‚æ¸¬è©¦ (å…Œæ›æ—¥å¿—é©—è­‰)</button>
        <button id="sectRewardTest" style="background: #ff9800;">7. Era 3 çå‹µæ¸¬è©¦ (ç™¾å¹´éˆè‰)</button>
    </div>
    <div style="margin-top: 20px; padding: 10px; border: 1px solid #FFD700; border-radius: 8px;">
        <h3 style="color: #FFD700;">è¦–è¦ºç‰¹æ•ˆæ¸¬è©¦ (Pixi.js)</h3>
        <button id="testPixiLevelUp" style="background: #4CAF50;">å‡ç´šç‰¹æ•ˆ (å±€éƒ¨)</button>
        <button id="testPixiBreakthrough" style="background: #FFD700; color: black;">çªç ´æˆåŠŸ (å…¨å±)</button>
        <button id="testPixiBreakthroughFail" style="background: #F44336;">çªç ´å¤±æ•— (å…¨å±)</button>
        <button id="testPixiReincarnation" style="background: #9C27B0;">è¼ªè¿´ç‰¹æ•ˆ (å…¨å±)</button>
        <button id="testPixiText" style="background: #03A9F4;">é£„å­—é€šçŸ¥ç‰¹æ•ˆ</button>
        <button id="testPixiBg" style="background: #607D8B;">åˆ‡æ›èƒŒæ™¯ (Era 1-6)</button>
    </div>
    <div style="margin-top: 20px; padding: 10px; border: 1px solid #444; border-radius: 8px;">
        <h3>å­˜æª”åŠŸèƒ½æ¸¬è©¦</h3>
        <button id="testSaveCode">ç”Ÿæˆå­˜æª”ç¢¼</button>
        <button id="testLoadCode">è®€å–å­˜æª”ç¢¼</button>
        <button id="testSaveStorage">ä¿å­˜è‡³ Storage</button>
        <button id="testLoadStorage">å¾ Storage è®€å–</button>
        <div style="margin-top: 10px;">
            <textarea id="saveCodeArea" style="width: 100%; background: #222; color: #fff; border: 1px solid #555;"
                rows="5" placeholder="åœ¨æ­¤è™•è²¼ä¸Šå­˜æª”ç¢¼..."></textarea>
        </div>
    </div>
    <div id="output"></div>

    <script type="module">
        const output = document.getElementById('output');

        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const span = document.createElement('span');
            span.className = type;
            span.textContent = `[${time}] ${msg}\n`;
            output.appendChild(span);
            output.scrollTop = output.scrollHeight;
        }

        let resourceManager = null;
        let buildingManager = null;
        let SaveSystem = null;
        // Pre-define window.game as a fallback
        window.game = {
            resourceManager: null,
            buildingManager: null,
            uiManager: { addLog: (msg, type) => log(`[GameLog] ${msg}`, type || 'info') }
        };

        // åˆå§‹åŒ–
        async function init() {
            try {
                log('è¼‰å…¥æ¨¡çµ„èˆ‡ CSV è³‡æ–™...', 'info');
                const { default: ResourceManager } = await import('./src/data/Resources.js');
                const { default: BuildingManager } = await import('./src/utils/BuildingManager.js');
                const { default: SaveSystemModule } = await import('./src/utils/saveSystem.js');
                SaveSystem = SaveSystemModule;
                const { loadBuildings } = await import('./src/data/Buildings.js');
                const { default: EraManager } = await import('./src/utils/EraManager.js');
                const { default: SkillManager } = await import('./src/utils/SkillManager.js');
                const { default: LanguageManager } = await import('./src/utils/LanguageManager.js');

                // 0. èªè¨€ç³»çµ±åˆå§‹åŒ– (æœ€å„ªå…ˆ)
                await LanguageManager.getInstance().init();

                // 1. è³‡æºåˆå§‹åŒ–
                resourceManager = new ResourceManager();
                await resourceManager.init();

                // 2. æ™‚ä»£èˆ‡åŠŸæ³•åˆå§‹åŒ–
                await EraManager.init();
                await SkillManager.init();

                // 3. å»ºç¯‰è³‡æ–™åˆå§‹åŒ–
                await loadBuildings();
                buildingManager = new BuildingManager(resourceManager);
                buildingManager.init();

                // Mock window.game for modules that depend on it (like SectManager)
                // Update the pre-defined object properties instead of reassignment
                window.game.resourceManager = resourceManager;
                window.game.buildingManager = buildingManager;
                // uiManager is already set in pre-define.
                window.game.saveSystem = null; // Set later if needed

                // 4. Pixi åˆå§‹åŒ–
                log('åˆå§‹åŒ– Pixi.js...', 'info');
                const { default: PixiApp } = await import('./src/views/pixi/PixiApp.js');
                const pixiApp = new PixiApp();
                await pixiApp.init(document.getElementById('pixi-container'));
                window.game.pixiApp = pixiApp;
                log('âœ“ Pixi.js åˆå§‹åŒ–å®Œæˆ', 'success');

                log('âœ“ æ¨¡çµ„è¼‰å…¥æˆåŠŸ', 'success');

                const lingli = resourceManager.getResource('lingli');
                const money = resourceManager.getResource('money');

                if (lingli && money) {
                    log(`éˆåŠ›ç”¢ç‡: ${lingli.rate}/ç§’`, 'info');
                    log(`é‡‘éŒ¢ç”¢ç‡: ${money.rate}/ç§’`, 'info');
                } else {
                    log('âœ— ç„¡æ³•è®€å–åŸºç¤è³‡æºæ•¸æ“š', 'error');
                }

            } catch (e) {
                log(`âœ— åˆå§‹åŒ–å¤±æ•—: ${e.message}`, 'error');
                log(e.stack, 'error');
            }
        }

        // æ¸¬è©¦è³‡æºç³»çµ±
        document.getElementById('testResources').addEventListener('click', () => {
            if (!resourceManager) {
                log('âœ— è³‡æºç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }

            log('\n=== æ¸¬è©¦è³‡æºç³»çµ± ===', 'info');
            const resources = resourceManager.getUnlockedResources();

            for (const [key, res] of Object.entries(resources)) {
                log(`${res.name}: å€¼=${res.value.toFixed(2)}, æœ€å¤§=${res.max}, ç”¢ç‡=${res.rate}/ç§’, é¡å‹=${res.type}`, 'info');
            }

            log('âœ“ è³‡æºç³»çµ±æ¸¬è©¦å®Œæˆ', 'success');
        });

        // æ¸¬è©¦å»ºç¯‰ç³»çµ±
        document.getElementById('testBuildings').addEventListener('click', () => {
            if (!buildingManager) {
                log('âœ— å»ºç¯‰ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }

            log('\n=== æ¸¬è©¦å»ºç¯‰ç³»çµ± ===', 'info');
            const buildings = buildingManager.exportData().buildings;

            for (const [key, building] of Object.entries(buildings)) {
                log(`${key}: ç­‰ç´š=${building.level}`, 'info');
            }

            log('âœ“ å»ºç¯‰ç³»çµ±æ¸¬è©¦å®Œæˆ', 'success');
        });

        // æ¸¬è©¦æ‰‹å‹•æ¡é›†
        document.getElementById('testManualGather').addEventListener('click', () => {
            if (!resourceManager) {
                log('âœ— è³‡æºç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }

            log('\n=== æ¸¬è©¦æ‰‹å‹•æ¡é›† ===', 'info');

            const lingli = resourceManager.getResource('lingli');
            const before = lingli.value;

            log(`æ¡é›†å‰éˆåŠ›: ${before.toFixed(2)}`, 'info');

            const result = resourceManager.manualGather('lingli');
            const after = lingli.value;

            log(`æ¡é›†çµæœ: ${result ? 'æˆåŠŸ' : 'å¤±æ•—'}`, result ? 'success' : 'error');
            log(`æ¡é›†å¾ŒéˆåŠ›: ${after.toFixed(2)}`, 'info');
            log(`å¢åŠ é‡: ${(after - before).toFixed(2)}`, after > before ? 'success' : 'error');

            if (after > before) {
                log('âœ“ æ‰‹å‹•æ¡é›†åŠŸèƒ½æ­£å¸¸', 'success');
            } else {
                log('âœ— æ‰‹å‹•æ¡é›†åŠŸèƒ½ç•°å¸¸', 'error');
            }
        });

        // æ¸¬è©¦è‡ªå‹•å¢é•· (å„ªåŒ–å®‰å…¨æ€§ï¼šä¸å†é‡ç½®æ­£å¼æ•¸æ“š)
        document.getElementById('testAutoGrow').addEventListener('click', async () => {
            if (!resourceManager) {
                log('âœ— è³‡æºç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }

            log('\n=== æ¸¬è©¦è‡ªå‹•å¢é•· ===', 'info');

            // å°å…¥ PlayerManager
            const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');

            // å‚™ä»½åŸå§‹ç‹€æ…‹
            const originalState = JSON.parse(JSON.stringify(PlayerManager.state));
            const originalIsExhausted = PlayerManager.isLifespanExhausted;

            try {
                // è‡¨æ™‚æ¨¡æ“¬å£½å…ƒç‹€æ…‹ï¼Œé˜²æ­¢æ¸¬è©¦éç¨‹ä¸­è§¸ç™¼é‡ç½®é‚è¼¯
                // ç›´æ¥ä¿®æ”¹å¯¦ä¾‹æ–¹æ³•ï¼Œç¢ºä¿ ResourceManager å¼•ç”¨åˆ°çš„å¯¦ä¾‹ä¹Ÿèƒ½ç”Ÿæ•ˆ
                PlayerManager.isLifespanExhausted = () => {
                    // console.log('Mock isLifespanExhausted called -> false');
                    return false;
                };

                // å¼·åˆ¶è¨­å®šç‚ºæ™‚ä»£1ã€ç­‰ç´š1
                PlayerManager.state.eraId = 1;
                PlayerManager.state.level = 1;

                // æª¢æŸ¥å¿…è¦ç‹€æ…‹
                log(`ResourceManager Loaded: ${resourceManager.isLoaded}`, 'info');
                const lingli = resourceManager.getResource('lingli');
                if (!lingli) {
                    log('âœ— æ‰¾ä¸åˆ°éˆåŠ›è³‡æº', 'error');
                    return;
                }

                // å¼·åˆ¶è§£é–ä¸¦æ­¸é›¶
                lingli.unlocked = true;
                lingli.value = 0;

                log(`éˆåŠ›ç‹€æ…‹: Unlocked=${lingli.unlocked}, Value=${lingli.value}`, 'info');
                log(`PlayerManager: Era=${PlayerManager.getEraId()}, Level=${PlayerManager.getLevel()}`, 'info');
                log(`Lifespan Exhausted Check: ${PlayerManager.isLifespanExhausted()}`, 'info');

                const before = lingli.value;
                const baseRate = lingli.rate;

                const currentEra = PlayerManager.getEraId();
                const currentLevel = PlayerManager.getLevel();
                const lingliConsumption = (currentEra - 1) * 10 + currentLevel - 2;
                const netRate = baseRate - lingliConsumption;

                log(`æ¸¬è©¦å‰éˆåŠ›: ${before.toFixed(2)}`, 'info');
                log(`éˆåŠ›åŸºç¤ç”¢ç‡: ${baseRate}/ç§’`, 'info');
                log(`éˆåŠ›æ¶ˆè€—: ${lingliConsumption}/ç§’ (Era${currentEra} Lv${currentLevel})`, 'info');
                log(`éˆåŠ›æ·¨ç”¢ç‡: ${netRate.toFixed(2)}/ç§’`, 'info');

                // æ¨¡æ“¬ 5 ç§’æ›´æ–°
                log('åŸ·è¡Œ update(5)...', 'info');
                resourceManager.update(5);

                const after = lingli.value;
                const expected = netRate * 5;
                const actual = after - before;

                log(`5ç§’å¾ŒéˆåŠ›: ${after.toFixed(2)}`, 'info');
                log(`å¯¦éš›å¢åŠ : ${actual.toFixed(2)}`, 'info');
                log(`é æœŸå¢åŠ : ${expected.toFixed(2)}`, 'info');

                if (Math.abs(actual - expected) < 0.01 && actual > 0) {
                    log('âœ“ è‡ªå‹•å¢é•·åŠŸèƒ½æ­£å¸¸', 'success');
                } else {
                    log('âœ— è‡ªå‹•å¢é•·åŠŸèƒ½ç•°å¸¸', 'error');
                    log(`å·®ç•°: ${Math.abs(actual - expected).toFixed(4)}`, 'error');
                }
            } catch (e) {
                log(`âœ— æ¸¬è©¦éç¨‹ä¸­å‡ºéŒ¯: ${e.message}`, 'error');
                console.error(e);
            } finally {
                // æ¢å¾©åŸå§‹ç‹€æ…‹èˆ‡æ–¹æ³•
                PlayerManager.state = originalState;
                PlayerManager.isLifespanExhausted = originalIsExhausted;
                log('âœ“ å·²æ¢å¾© PlayerManager åŸå§‹ç‹€æ…‹', 'info');
            }
        });

        // æ¸¬è©¦å£½å…ƒå·²ç›¡é‡ç½®
        document.getElementById('testLifespanReset').addEventListener('click', async () => {
            if (!resourceManager) {
                log('âœ— è³‡æºç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }

            log('\n=== æ¸¬è©¦å£½å…ƒå·²ç›¡é‡ç½® ===', 'info');
            log('æ³¨æ„ï¼šæ­¤æ¸¬è©¦æœƒæ¨¡æ“¬å£½å…ƒå·²ç›¡ï¼Œä¸¦æª¢æŸ¥æ™‚æœŸé€²åº¦æ˜¯å¦é‡ç½®', 'info');

            const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');

            // ä¿å­˜åŸå§‹ç‹€æ…‹èˆ‡æ–¹æ³•
            const originalState = JSON.parse(JSON.stringify(PlayerManager.state));
            const originalSave = PlayerManager._saveState;

            try {
                // æ””æˆªå„²å­˜ï¼Œé˜²æ­¢å½±éŸ¿æ­£å¼æ•¸æ“š
                PlayerManager._saveState = () => { /* æ¸¬è©¦ä¸­ä¸å„²å­˜ */ };

                // æ¨¡æ“¬å£½å…ƒå·²ç›¡ (å°‡ totalStartTimestamp è¨­ç‚ºå¾ˆä¹…ä»¥å‰)
                const maxLifespanYears = PlayerManager.getMaxLifespan();
                const farPast = Date.now() - (maxLifespanYears + 1) * 60000;

                PlayerManager.state.totalStartTimestamp = farPast;
                PlayerManager.state.isReincarnating = false;
                const oldStartTimestamp = PlayerManager.state.startTimestamp;

                log(`æ¨¡æ“¬å·²éå¹´æ­²: ${(Date.now() - farPast) / 60000} å¹´`, 'info');
                log(`å£½å…ƒä¸Šé™: ${maxLifespanYears} å¹´`, 'info');
                log(`æ˜¯å¦å·²ç›¡: ${PlayerManager.isLifespanExhausted()}`, 'info');
                log(`ç•¶å‰æ™‚æœŸé–‹å§‹æ™‚é–“: ${oldStartTimestamp}`, 'info');

                // è§¸ç™¼è³‡æºæ›´æ–°
                log('æ›´æ–°è³‡æºç³»çµ±...', 'info');
                resourceManager.update(1);

                // æª¢æŸ¥çµæœ
                const newStartTimestamp = PlayerManager.state.startTimestamp;
                const isReinc = PlayerManager.state.isReincarnating;

                log(`é‡ç½®å¾Œæ™‚æœŸé–‹å§‹æ™‚é–“: ${newStartTimestamp}`, 'info');
                log(`è¼ªè¿´ç‹€æ…‹æ¨™è¨˜: ${isReinc}`, 'info');

                if (newStartTimestamp > oldStartTimestamp && isReinc === true) {
                    log('âœ“ å£½å…ƒå·²ç›¡é‡ç½®åŠŸèƒ½æ­£å¸¸', 'success');
                } else {
                    log('âœ— å£½å…ƒå·²ç›¡é‡ç½®åŠŸèƒ½ç•°å¸¸', 'error');
                }

            } catch (e) {
                log(`âœ— æ¸¬è©¦å¤±æ•—: ${e.message}`, 'error');
            } finally {
                // æ¢å¾©åŸå§‹ç‹€æ…‹
                PlayerManager.state = originalState;
                PlayerManager._saveState = originalSave;
                log('âœ“ å·²æ¢å¾© PlayerManager åŸå§‹ç‹€æ…‹', 'info');
            }
        });

        // æ¸¬è©¦ä¾å¥³è‡ªå‹•åˆæˆ
        document.getElementById('testMaidSystem').addEventListener('click', async () => {
            if (!buildingManager || !resourceManager) {
                log('âœ— ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }

            log('\n=== æ¸¬è©¦ä¾å¥³è‡ªå‹•åˆæˆ ===', 'info');

            // 1. è¨­ç½®ä¾å¥³å»ºç¯‰
            const maid = buildingManager.getBuilding('maid');
            if (maid) {
                maid.level = 1;
                log('âœ“ å·²å°‡ä¾å¥³ç­‰ç´šè¨­ç‚º 1', 'success');
            } else {
                log('âœ— æ‰¾ä¸åˆ°ä¾å¥³å»ºç¯‰', 'error');
                return;
            }

            // 2. è¨­ç½®è³‡æºèˆ‡åˆæˆç›®æ¨™
            const targetRes = 'stone_mid'; // ä¸­å“éˆçŸ³
            const recipe = { 'stone_low': 5, 'lingli': 10 }; // å‡è¨­é…æ–¹

            // ç¢ºä¿æœ‰è¶³å¤ ææ–™
            const stoneLow = resourceManager.getResource('stone_low');
            const lingli = resourceManager.getResource('lingli');
            const stoneMid = resourceManager.getResource('stone_mid');

            stoneLow.value = 100;
            lingli.value = 1000;
            stoneMid.value = 0;

            log(`åˆå§‹ææ–™: ä¸‹å“éˆçŸ³=${stoneLow.value}, éˆåŠ›=${lingli.value}`, 'info');
            log(`ç›®æ¨™ç”¢ç‰©: ä¸­å“éˆçŸ³=${stoneMid.value}`, 'info');

            // ç¢ºä¿ç›®æ¨™è³‡æºå·²è§£é– (craft æ–¹æ³•æœƒæª¢æŸ¥ unlocked)
            if (!stoneMid.unlocked) {
                resourceManager.unlockResource(targetRes);
                log(`âœ“ å·²æ‰‹å‹•è§£é– ${targetRes}`, 'info');
            }

            // 3. å•Ÿç”¨è‡ªå‹•åˆæˆ
            buildingManager.maidAutoTargets[targetRes] = true;
            log(`âœ“ å·²å•Ÿç”¨ ${targetRes} çš„è‡ªå‹•åˆæˆ`, 'success');

            // 4. åŸ·è¡Œè‡ªå‹•åˆæˆé‚è¼¯
            log('åŸ·è¡Œ runMaidWork()...', 'info');
            buildingManager.runMaidWork();

            // 5. é©—è­‰çµæœ
            // ç”±æ–¼ runMaidWork æ¯æ¬¡åªåˆæˆä¸€å€‹ï¼Œæ‰€ä»¥ç”¢ç‰©æ‡‰è©²å¢åŠ  1
            const success = stoneMid.value === 1;
            log(`åˆæˆå¾Œ: ä¸‹å“éˆçŸ³=${stoneLow.value}, éˆåŠ›=${lingli.value}`, 'info');
            log(`ç”¢ç‰©æ•¸é‡: ${stoneMid.value}`, success ? 'success' : 'error');

            if (success) {
                log('âœ“ ä¾å¥³è‡ªå‹•åˆæˆåŠŸèƒ½æ­£å¸¸', 'success');
            } else {
                log('âœ— ä¾å¥³è‡ªå‹•åˆæˆå¤±æ•—', 'error');
            }

            // æ¸…ç†ç‹€æ…‹
            maid.level = 0;
            buildingManager.maidAutoTargets[targetRes] = false;
        });

        // æ¸¬è©¦ä¿®ç…‰æ™‚é–“é¡¯ç¤º
        document.getElementById('testTrainingTime').addEventListener('click', async () => {
            log('\n=== æ¸¬è©¦ä¿®ç…‰æ™‚é–“é¡¯ç¤º ===', 'info');
            const { default: EraManager } = await import('./src/utils/EraManager.js');
            const { default: LanguageManager } = await import('./src/utils/LanguageManager.js');

            if (!EraManager.isLoaded) await EraManager.init();
            await LanguageManager.getInstance().init();

            // Force zh-CN to ensure text matching
            await LanguageManager.getInstance().loadLanguage('zh-CN');

            const mockEraId = 1;
            const mockLevel = 1;
            const requiredTime = EraManager.getLevelUpRequiredTime(mockEraId, mockLevel); // Seconds

            log(`ç­‰ç´š 1 æ‰€éœ€ç¸½æ™‚é–“: ${requiredTime} ç§’`, 'info');

            // Case 1: 0 ç¶“é©—
            let trainingTime = 0;
            let result = EraManager.checkLevelUpRequirements(mockEraId, mockLevel, trainingTime, [], {});
            log(`ä¿®ç·´æ™‚é–“ 0ç§’ -> æç¤º: ${result.reason}`, 'info');

            // æª¢æŸ¥æ˜¯å¦é¡¯ç¤ºç‚ºå‰©é¤˜æ™‚é–“ (ç¸½æ™‚é–“)
            // 0 ç¶“é©—æ™‚ï¼Œå‰©é¤˜æ™‚é–“ = ç¸½æ™‚é–“
            const totalInSi = (requiredTime / 60).toFixed(2);
            if (result.reason.includes(totalInSi)) {
                log(`âœ“ (0ç¶“é©—)æ•¸å€¼æ­£ç¢º: ${totalInSi}`, 'success');
            } else {
                log(`âœ— (0ç¶“é©—)æ•¸å€¼éŒ¯èª¤`, 'error');
            }

            // Case 2: å·²ä¿®ç·´ä¸€åŠæ™‚é–“
            trainingTime = requiredTime / 2;
            result = EraManager.checkLevelUpRequirements(mockEraId, mockLevel, trainingTime, [], {});
            log(`ä¿®ç·´æ™‚é–“ ${trainingTime}ç§’ -> æç¤º: ${result.reason}`, 'info');

            const remainingInSi = ((requiredTime - trainingTime) / 60).toFixed(2);
            if (result.reason.includes(remainingInSi)) {
                log(`âœ“ (50%ç¶“é©—)æ•¸å€¼æ­£ç¢º: ${remainingInSi} (é¡¯ç¤ºå‰©é¤˜è€Œéç¸½éœ€)`, 'success');
            } else {
                log(`âœ— (50%ç¶“é©—)æ•¸å€¼éŒ¯èª¤. é æœŸåŒ…å«: ${remainingInSi}`, 'error');
            }

            // Case 3: æª¢æŸ¥æ˜¯å¦æœ‰ "é‚„éœ€" å­—æ¨£
            if (result.reason.includes('è¿˜éœ€') || result.reason.includes('é‚„éœ€')) {
                log('âœ“ åŒ…å« "è¿˜éœ€/é‚„éœ€" å­—æ¨£', 'success');
            } else {
                log(`âœ— ç¼ºå°‘ "è¿˜éœ€" å­—æ¨£`, 'error');
            }
        });

        // æ¸¬è©¦æç¤ºç³»çµ±ç‹€æ…‹
        document.getElementById('testHintSystem').addEventListener('click', async () => {
            log('\n=== æ¸¬è©¦æç¤ºç³»çµ±ç‹€æ…‹ ===', 'info');
            const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');

            // 1. Check if shownEraHints exists in default state
            const hints = PlayerManager.getHints();
            log(`Hints State: ${JSON.stringify(hints)}`, 'info');

            if (Array.isArray(hints.shownEraHints)) {
                log('âœ“ shownEraHints array exists', 'success');
            } else {
                log('âœ— shownEraHints is missing or not an array', 'error');
            }

            // 2. Mock adding a hint
            const mockEraId = 99;
            const currentShown = hints.shownEraHints || [];
            if (!currentShown.includes(mockEraId)) {
                const newShown = [...currentShown, mockEraId];
                PlayerManager.updateHints({ shownEraHints: newShown });

                const updatedHints = PlayerManager.getHints();
                log(`Updated Hints: ${JSON.stringify(updatedHints)}`, 'info');

                if (updatedHints.shownEraHints.includes(mockEraId)) {
                    log('âœ“ Hint state updated successfully', 'success');
                } else {
                    log('âœ— Failed to update hint state', 'error');
                }

                // Cleanup (optional, but good for repetitive testing)
                const cleanupShown = newShown.filter(id => id !== mockEraId);
                PlayerManager.updateHints({ shownEraHints: cleanupShown });
            } else {
                log('âœ“ Mock hint already exists (skipping update test)', 'info');
            }
        });

        // æ¸¬è©¦æ¸¡åŠ«é‡ç½®
        document.getElementById('testTribulationReset').addEventListener('click', async () => {
            log('\n=== æ¸¬è©¦æ¸¡åŠ«é‡ç½®æ©Ÿåˆ¶ ===', 'info');
            const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');
            const { default: EraManager } = await import('./src/utils/EraManager.js');
            await EraManager.init();

            // 1. å‚™ä»½ç‹€æ…‹
            const stateBackup = JSON.parse(JSON.stringify(PlayerManager.state));

            try {
                // 2. è¨­ç½®åˆå§‹ç‹€æ…‹ï¼šé‡‘ä¸¹æœŸæ»¿ç´š (Era 3, Lv 10)
                PlayerManager.state.eraId = 3;
                PlayerManager.state.level = 10;
                // ç¢ºä¿ consumedPills å­˜åœ¨
                PlayerManager.state.consumedPills = PlayerManager.state.consumedPills || {};

                // 3. æœç”¨ä¸¹è—¥ç›´è‡³ 100% æˆåŠŸç‡ (Base 0.5 + 0.5)
                // tribulation_pill: +0.05 * 10 = +0.5
                PlayerManager.state.consumedPills['tribulation_pill'] = 10;

                const rateBefore = PlayerManager.getTribulationSuccessRate();
                log(`åˆå§‹ç‹€æ…‹ (Era 3):`, 'info');
                log(`æœç”¨æ¸¡åŠ«ä¸¹: 10é¡†`, 'info');
                log(`æ¸¡åŠ«æˆåŠŸç‡: ${(rateBefore * 100).toFixed(1)}%`, 'info');

                if (rateBefore < 1.0) {
                    log('âš  è­¦å‘Š: æˆåŠŸç‡æœªé” 100%ï¼Œæ¸¬è©¦å¯èƒ½å¤±æ•—', 'warning');
                }

                // 4. Mock canUpgrade (é¿å…è³‡æºæª¢æŸ¥)
                const originalCanUpgrade = PlayerManager.canUpgrade;
                PlayerManager.canUpgrade = () => ({ canUpgrade: true, reason: 'Test Override' });

                // 5. åŸ·è¡Œå‡éš
                log('åŸ·è¡Œ upgrade()...', 'info');
                // upgrade å…§éƒ¨æœƒèª¿ç”¨ attemptTribulation -> 100% æˆåŠŸç‡æ‡‰å¿…é
                const success = PlayerManager.upgrade({});

                if (success) {
                    log('æ¸¡åŠ«æˆåŠŸ!', 'success');
                    log(`æ–°å¢ƒç•Œ: Era ${PlayerManager.state.eraId}`, 'info');

                    // 6. é©—è­‰é‡ç½®
                    const countAfter = PlayerManager.state.consumedPills['tribulation_pill'] || 0;
                    const rateAfter = PlayerManager.getTribulationSuccessRate();

                    if (countAfter === 0) {
                        log(`é‡ç½®å¾Œæ¸¡åŠ«ä¸¹æ•¸é‡: ${countAfter} (é æœŸ 0)`, 'success');
                    } else {
                        log(`é‡ç½®å¾Œæ¸¡åŠ«ä¸¹æ•¸é‡: ${countAfter} (é æœŸ 0)`, 'error');
                    }

                    const expectedRate = 0.5;
                    const diff = Math.abs(rateAfter - expectedRate);
                    if (diff < 0.01) {
                        log(`é‡ç½®å¾ŒæˆåŠŸç‡: ${(rateAfter * 100).toFixed(1)}% (é æœŸ 50.0%)`, 'success');
                        log('âœ“ æ¸¬è©¦é€šéï¼šæˆåŠŸç‡å·²æ­£ç¢ºé‡ç½®', 'success');
                    } else {
                        log(`é‡ç½®å¾ŒæˆåŠŸç‡: ${(rateAfter * 100).toFixed(1)}% (é æœŸ 50.0%)`, 'error');
                        log('âœ— æ¸¬è©¦å¤±æ•—ï¼šæœªé‡ç½®æˆåŠŸç‡', 'error');
                    }

                } else {
                    log('âœ— æ¸¡åŠ«å¤±æ•— (é æœŸæ‡‰æˆåŠŸ)', 'error');
                }

                // Restore method
                PlayerManager.canUpgrade = originalCanUpgrade;

            } catch (e) {
                log(`âœ— æ¸¬è©¦å‡ºéŒ¯: ${e.message}`, 'error');
                console.error(e);
            } finally {
                // 7. æ¢å¾©ç‹€æ…‹
                PlayerManager.state = stateBackup;
                log('âœ“ å·²æ¢å¾©åŸå§‹ç‹€æ…‹', 'info');
            }
        });

        // --- å®—é–€ç³»çµ±æ¸¬è©¦é‚è¼¯ ---
        let SectManager = null;

        // Lazy load SectManager manually for tests if not global
        async function getSectManager() {
            if (SectManager) return SectManager;
            const { default: sm } = await import('./src/utils/SectManager.js');
            SectManager = sm;
            return SectManager;
        }

        document.getElementById('sectCheckUnlock').addEventListener('click', async () => {
            log('\n=== å®—é–€è§£é–æ¸¬è©¦ ===', 'info');
            const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');

            // Set Era to 2
            PlayerManager.state.eraId = 2;
            log('å·²å°‡å¢ƒç•Œè¨­ç‚º 2 (ç¯‰åŸºæœŸ)', 'info');

            // Check logic (MainView visibility logic mock)
            if (PlayerManager.getEraId() >= 2) {
                log('âœ“ è§£é–æ¢ä»¶æª¢æŸ¥é€šé: Era >= 2', 'success');
            } else {
                log('âœ— è§£é–æ¢ä»¶æª¢æŸ¥å¤±æ•—', 'error');
            }
        });

        document.getElementById('sectAddRes').addEventListener('click', async () => {
            if (!resourceManager) return log('âœ— è³‡æºç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');

            // Add basic resources for contribution (Era 2 cost)
            // Era 2 cost: stone_low: 100, wood: 100
            const resList = ['stone_low', 'wood', 'spirit_grass_low'];
            resList.forEach(id => {
                const res = resourceManager.getResource(id);
                if (res) {
                    res.unlocked = true;
                    res.value += 1000;
                    log(`å·²æ·»åŠ  ${id}: +1000 (ç•¶å‰: ${res.value})`, 'info');
                }
            });

            // Unlock lingli just in case
            const lingli = resourceManager.getResource('lingli');
            if (lingli) { lingli.unlocked = true; lingli.value = 10000; }
        });

        document.getElementById('sectContribute').addEventListener('click', async () => {
            const sm = await getSectManager();
            const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');

            log('\n=== å®—é–€è²¢ç»æ¸¬è©¦ ===', 'info');

            // Ensure window.game is set (fix for undefined error)
            if (!window.game || !window.game.resourceManager) {
                log('ä¿®å¾© window.game åƒè€ƒ...', 'info');
                window.game = window.game || {};
                window.game.resourceManager = resourceManager;
                window.game.buildingManager = buildingManager;
                window.game.uiManager = { addLog: (msg, type) => log(`[GameLog] ${msg}`, type || 'info') };
            }

            // Force active contribution count for test
            sm.state.contributionCount = 3;
            log(`é‡ç½®ä»Šæ—¥è²¢ç»æ¬¡æ•¸ç‚º: ${sm.state.contributionCount}`, 'info');

            // Mock Player Era if needed (ensure Era 2 for low cost)
            if (PlayerManager.getEraId() < 2) PlayerManager.state.eraId = 2;

            const beforeDev = sm.state.developmentPoints;
            const result = sm.contribute();

            if (result.success) {
                log(`âœ“ è²¢ç»æˆåŠŸ!`, 'success');
                log(`ç™¼å±•åº¦: ${beforeDev} -> ${sm.state.developmentPoints}`, 'info');
                log(`å‰©é¤˜æ¬¡æ•¸: ${sm.state.contributionCount}`, 'info');
            } else {
                log(`âœ— è²¢ç»å¤±æ•—: ${result.msg}`, 'error');
            }
        });

        document.getElementById('sectMaxLevel').addEventListener('click', async () => {
            const sm = await getSectManager();
            sm.state.sectLevel = 5;
            sm.state.developmentPoints = 999;
            log('âœ“ å·²å°‡å®—é–€è¨­ç‚º LV5 (æ»¿ç´š)', 'success');
        });

        document.getElementById('sectTaskTest').addEventListener('click', async () => {
            const sm = await getSectManager();
            log('\n=== å®—é–€ä»»å‹™æ¸¬è©¦ ===', 'info');

            // 1. Refresh
            if (sm.refreshTasks) sm.refreshTasks();
            else if (sm.default && sm.default.refreshTasks) sm.default.refreshTasks();
            log('1. å·²åˆ·æ–°ä»»å‹™åˆ—è¡¨', 'info');
            if (sm.state.tasks.length > 0) {
                log(`ç”Ÿæˆäº† ${sm.state.tasks.length} å€‹ä»»å‹™`, 'success');
                const task = sm.state.tasks[0];
                log(`> ä»»å‹™0: ${task.name} (æ™‚é–“: ${task.duration / 1000}s)`, 'info');

                // Verify Description Translation
                const { default: LanguageManager } = await import('./src/utils/LanguageManager.js');
                await LanguageManager.getInstance().init();
                const translatedDesc = LanguageManager.getInstance().t(task.desc);
                log(`  æè¿°Key: ${task.desc}`, 'info');
                log(`  ç¿»è­¯å…§å®¹: ${translatedDesc}`, 'info');

                // 2. Start Task
                // Force 5 seconds duration for test
                task.duration = 5000;
                const startRes = sm.startTask(0);
                if (startRes.success) {
                    log(`2. ä»»å‹™é–‹å§‹æˆåŠŸ (æ¸¬è©¦ä¿®æ”¹æ™‚é•·ç‚º 5s)`, 'success');

                    // 3. Wait/Simulate
                    log('...æ¨¡æ“¬ç­‰å¾… 5ç§’...', 'info');
                    // Manually set start time to past
                    sm.state.activeTask.startTime = Date.now() - 6000;

                    // 4. Claim
                    const claimRes = sm.claimTaskReward();
                    if (claimRes.success) {
                        log(`3. çå‹µé ˜å–æˆåŠŸ! ç²å¾—: ${JSON.stringify(claimRes.rewards)}`, 'success');
                    } else {
                        log(`âœ— é ˜å–å¤±æ•—: ${claimRes.msg}`, 'error');
                    }
                } else {
                    log(`âœ— ä»»å‹™é–‹å§‹å¤±æ•—: ${startRes.msg}`, 'error');
                }
            } else {
                log('âœ— ä»»å‹™åˆ—è¡¨ç‚ºç©º', 'error');
            }
        });

        document.getElementById('sectMarketTest').addEventListener('click', async () => {
            const sm = await getSectManager();
            log('\n=== é›²æµ·å¤©å¸‚æ¸¬è©¦ ===', 'info');

            // Force reload language to ensure latest keys are present (Hotfix for test env)
            const { default: LanguageManager } = await import('./src/utils/LanguageManager.js');
            await LanguageManager.getInstance().loadLanguage('zh-TW');
            log('å·²å¼·åˆ¶åˆ·æ–°èªè¨€æ•¸æ“š', 'info');

            // 1. Give money
            sm.state.playerContribution = 1000;
            log('å·²è¨­ç½®ç©å®¶è²¢ç»: 1000', 'info');

            // 2. Mock Logger to intercept message
            const originalLog = window.game.uiManager.addLog;
            let lastLogMsg = '';
            window.game.uiManager.addLog = (msg, type) => {
                lastLogMsg = msg;
                log(`[æ‹¦æˆªæ—¥å¿—] ${msg}`, 'info');
            };

            // 3. Buy Item
            const itemId = 'spirit_jade'; // Cost 200 (Era 5) or similar
            // Force item availability just in case logic depends on Era
            // Market Items are hardcoded in SectManager, check if era restriction applies?
            // getMarketItem doens't check era, buyMarketItem doesn't check era explicitly (only validates cost).
            // Actually config has 'era' property but buy function doesn't seem to enforce it strictly, assuming UI filters it.
            // Let's use 'foundation_pill' which is Era 4. Or just force buy.

            const result = sm.buyMarketItem('foundation_pill'); // Cost 100

            // Restore logger
            window.game.uiManager.addLog = originalLog;

            if (result.success) {
                log('å…Œæ›æ“ä½œæˆåŠŸ', 'success');
                // Verify log content
                // "ğŸ›’ åœ¨é›²æµ·å¤©å¸‚å…Œæ›äº† ç¯‰åŸºä¸¹ x1ï¼Œæ¶ˆè€— 100 å®—é–€è²¢ç»"
                if (lastLogMsg.includes('æ¶ˆè€—') && lastLogMsg.includes('100')) {
                    log('âœ“ æ—¥èªŒå…§å®¹é©—è­‰é€šé (åŒ…å«ç‰©å“èˆ‡æ¶ˆè€—)', 'success');
                } else {
                    log(`âœ— æ—¥èªŒå…§å®¹ç¼ºä¹æ¶ˆè€—ä¿¡æ¯: ${lastLogMsg}`, 'error');
                }
            } else {
                log(`âœ— å…Œæ›å¤±æ•—: ${result.msg}`, 'error');
            }
        });

        document.getElementById('sectRewardTest').addEventListener('click', async () => {
            const sm = await getSectManager();
            const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');
            PlayerManager.state.eraId = 3;
            log('å·²å°‡å¢ƒç•Œè¨­ç‚º 3 (é‡‘ä¸¹æœŸ)', 'info');

            // 2. Refresh until we find spirit_grass_100y
            let found = false;
            let checks = 0;
            const target = 'spirit_grass_100y';

            log('é–‹å§‹éš¨æ©Ÿåˆ·æ–°ä»»å‹™å°‹æ‰¾ç™¾å¹´éˆè‰...', 'info');

            while (!found && checks < 20) {
                sm.refreshTasks();
                const tasks = sm.state.tasks;
                for (const t of tasks) {
                    if (t.reward[target]) {
                        const amount = t.reward[target];
                        const rarity = t.rarity;
                        log(`æ‰¾åˆ°ä»»å‹™ [${t.rarity}]: ${target} x${amount}`, 'info');

                        if ((rarity === 'rare' || rarity === 'epic') && amount >= 40) {
                            log(`âœ“ æ•¸å€¼ç¬¦åˆé æœŸ (>= 40)`, 'success');
                            found = true;
                        } else if (rarity === 'rare' || rarity === 'epic') {
                            log(`âœ— æ•¸å€¼éä½ (< 40)`, 'error');
                        }
                    }
                }
                checks++;
            }

            if (!found) {
                log('âš  å˜—è©¦ 20 æ¬¡åˆ·æ–°ä»æœªéš¨æ©Ÿåˆ°ç›®æ¨™çå‹µï¼Œå»ºè­°é‡è©¦', 'warning');
            }
        });

        // --- Pixi ç‰¹æ•ˆæ¸¬è©¦ ---
        document.getElementById('testPixiLevelUp').addEventListener('click', () => {
            if (window.game.pixiApp) {
                log('æ’­æ”¾å‡ç´šç‰¹æ•ˆ', 'info');
                window.game.pixiApp.playLevelUpEffect(window.innerWidth / 2, window.innerHeight / 2);
            }
        });
        document.getElementById('testPixiBreakthrough').addEventListener('click', () => {
            if (window.game.pixiApp) {
                log('æ’­æ”¾çªç ´æˆåŠŸç‰¹æ•ˆ', 'info');
                window.game.pixiApp.playBreakthroughEffect();
            }
        });
        document.getElementById('testPixiBreakthroughFail').addEventListener('click', () => {
            if (window.game.pixiApp) {
                log('æ’­æ”¾çªç ´å¤±æ•—ç‰¹æ•ˆ', 'info');
                window.game.pixiApp.playBreakthroughFailedEffect();
            }
        });
        document.getElementById('testPixiReincarnation').addEventListener('click', () => {
            if (window.game.pixiApp) {
                log('æ’­æ”¾è¼ªè¿´ç‰¹æ•ˆ', 'info');
                window.game.pixiApp.playReincarnationEffect();
            }
        });
        document.getElementById('testPixiText').addEventListener('click', () => {
            if (window.game.pixiApp) {
                log('æ’­æ”¾é£„å­—é€šçŸ¥', 'info');
                window.game.pixiApp.playCenterTextEffect("æ¸¬è©¦é€šçŸ¥ï¼šå¤©é“é…¬å‹¤", { color: 0x00BCD4 });
            }
        });
        let currentEraBg = 1;
        document.getElementById('testPixiBg').addEventListener('click', () => {
            if (window.game.pixiApp) {
                currentEraBg++;
                if (currentEraBg > 6) currentEraBg = 1;
                log(`åˆ‡æ›èƒŒæ™¯è‡³ Era ${currentEraBg}`, 'info');
                window.game.pixiApp.updateBackground(currentEraBg);
            }
        });

        // å­˜æª”ç³»çµ±æ¸¬è©¦
        document.getElementById('testSaveCode').addEventListener('click', () => {
            try {
                log('é–‹å§‹ç”Ÿæˆå­˜æª”ç¢¼...', 'info');
                if (!SaveSystem) {
                    log('âœ— SaveSystem é¡åˆ¥æœªè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ init() æ˜¯å¦æˆåŠŸ', 'error');
                    return;
                }
                if (!resourceManager || !buildingManager) {
                    log('âœ— ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                    return;
                }

                log('å¯¦ä¾‹åŒ– SaveSystem...', 'info');
                const saveSystem = new SaveSystem({ resourceManager, buildingManager });

                log('èª¿ç”¨ generateSaveCode()...', 'info');
                const code = saveSystem.generateSaveCode();

                if (!code) {
                    log('âœ— ç”Ÿæˆçš„å­˜æª”ç¢¼ç‚ºç©º (å¯èƒ½æœ‰éŒ¯èª¤åœ¨ Console)', 'error');
                } else {
                    document.getElementById('saveCodeArea').value = code;
                    log('âœ“ å·²ç”Ÿæˆå­˜æª”ç¢¼ï¼Œé•·åº¦: ' + code.length, 'success');
                }
            } catch (err) {
                log(`âœ— åŸ·è¡Œå´©æ½°: ${err.message}`, 'error');
                log(err.stack, 'error');
                console.error(err);
            }
        });

        document.getElementById('testLoadCode').addEventListener('click', async () => {
            const code = document.getElementById('saveCodeArea').value;
            if (!code) return log('âœ— è«‹æä¾›å­˜æª”ç¢¼', 'error');
            const saveSystem = new SaveSystem({ resourceManager, buildingManager });
            const data = saveSystem.parseSaveCode(code);
            if (data) {
                const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');
                log('è§£ææˆåŠŸï¼Œæ­£åœ¨è¼‰å…¥æ•¸æ“š...', 'info');
                if (data.player) PlayerManager.loadData(data.player);
                resourceManager.loadData(data.resources);
                buildingManager.loadData(data.buildings);
                log('âœ“ å­˜æª”ç¢¼è®€å–å®Œæˆ', 'success');
            } else {
                log('âœ— å­˜æª”ç¢¼ç„¡æ•ˆ', 'error');
            }
        });

        document.getElementById('testSaveStorage').addEventListener('click', () => {
            if (!resourceManager || !buildingManager) return log('âœ— ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
            const saveSystem = new SaveSystem({ resourceManager, buildingManager });
            saveSystem.saveToStorage();
            log('âœ“ å·²ä¿å­˜è‡³ Storage', 'success');
        });

        document.getElementById('testLoadStorage').addEventListener('click', async () => {
            if (!resourceManager || !buildingManager) return log('âœ— ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
            const saveSystem = new SaveSystem({ resourceManager, buildingManager });
            const data = saveSystem.loadFromStorage();
            if (data) {
                const { default: PlayerManager } = await import('./src/utils/PlayerManager.js');
                if (data.player) PlayerManager.loadData(data.player);
                resourceManager.loadData(data.resources);
                buildingManager.loadData(data.buildings);
                log('âœ“ å¾ Storage è®€å–å®Œæˆ', 'success');
            } else {
                log('âœ— Storage ä¸­ç„¡å­˜æª”', 'error');
            }
        });

        // è‡ªå‹•åˆå§‹åŒ–
        init();
    </script>
</body>

</html>