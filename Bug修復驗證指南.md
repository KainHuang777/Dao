# 數值檢核工具 Bug 修復驗證指南

## 🐛 已修復的問題

### 問題 1: 時期進度模擬顯示 undefined
**原因**：代碼使用 `era.id` 但實際數據結構使用 `era.eraId`

**修復內容**：
- 將所有 `era.id` 改為 `era.eraId`
- 添加數據載入檢查
- 添加控制台調試輸出

**驗證步驟**：
1. 訪問 `http://localhost:8000/balance-checker.html`
2. 點擊「開始模擬」按鈕
3. 檢查表格是否正確顯示：
   - ✅ 時期欄位顯示 1-12（不是 undefined）
   - ✅ 名稱欄位顯示正確的時期名稱（練氣期、築基期等）
   - ✅ 每個時期的數據都不同

**預期結果**：
```
時期 | 名稱   | 該時期壽元 | 累計壽元
-----|--------|-----------|----------
1    | 練氣期 | 80        | 80
2    | 築基期 | 200       | 280
3    | 金丹期 | 300       | 580
...
12   | 金仙   | 1200      | 7880
```

---

### 問題 2: 資源上限計算器不同時期顯示相同內容
**原因**：沒有根據時期解析 `up_capacity` 要求

**修復內容**：
- 解析每個時期的 `up_capacity` 欄位
- 新增「時期要求」欄位
- 新增「是否達標」判斷
- 根據時期顯示不同的資源要求

**驗證步驟**：
1. 訪問 `http://localhost:8000/balance-checker.html`
2. 在資源上限計算器中：
   - 道心值：輸入 100
   - 道證值：輸入 20
   - 目標時期：選擇「1 - 練氣期」
3. 點擊「計算資源上限」
4. 記錄「時期要求」欄位的數值
5. 切換到「3 - 金丹期」，再次計算
6. 對比兩次的「時期要求」是否不同

**預期結果**：

**練氣期（時期1）**：
```
資源   | 時期要求
-------|----------
靈力   | 500
金錢   | -
靈木   | -
靈石   | -
```

**金丹期（時期3）**：
```
資源   | 時期要求
-------|----------
靈力   | 10,000
金錢   | -
靈木   | -
靈石   | 5,000
```

---

## ✅ 完整測試流程

### 測試 A: 時期進度模擬

1. **啟動服務器**
   ```bash
   python -m http.server 8000
   ```

2. **訪問工具**
   ```
   http://localhost:8000/balance-checker.html
   ```

3. **執行測試**
   - 點擊「開始模擬」
   - 打開瀏覽器控制台（F12）
   - 查看控制台輸出：`載入的時期數據: [...]`

4. **驗證結果**
   - [ ] 表格顯示12行數據
   - [ ] 時期欄位：1, 2, 3, ..., 12
   - [ ] 名稱欄位：練氣期, 築基期, 金丹期, ...
   - [ ] 該時期壽元：80, 200, 300, ...（遞增）
   - [ ] 累計壽元：80, 280, 580, ...（累加）
   - [ ] 總體統計顯示：7880 年

---

### 測試 B: 資源上限計算器

1. **測試練氣期（時期1）**
   - 道心：0
   - 道證：0
   - 時期：1
   - 點擊「計算資源上限」
   - 驗證：靈力時期要求 = 500

2. **測試築基期（時期2）**
   - 道心：100
   - 道證：20
   - 時期：2
   - 點擊「計算資源上限」
   - 驗證：
     - 靈力時期要求 = 2,000
     - 靈石時期要求 = 1,000
     - 道心加成 = +10%
     - 道證加成 = +20%

3. **測試金丹期（時期3）**
   - 道心：100
   - 道證：20
   - 時期：3
   - 點擊「計算資源上限」
   - 驗證：
     - 靈力時期要求 = 10,000
     - 靈石時期要求 = 5,000
     - 靈力最終上限 = 132（基礎100 × 1.1 × 1.2）

4. **測試達標判斷**
   - 道心：1000
   - 道證：100
   - 時期：1
   - 驗證：所有資源顯示「✓ 達標」（綠色）

---

### 測試 C: 建築 ROI 分析

1. 點擊「分析建築 ROI」
2. 驗證：
   - [ ] 表格顯示所有建築
   - [ ] ROI 評級正確（優秀/中等/較低）
   - [ ] 按 ROI 降序排列

---

### 測試 D: 功法效益分析

1. 點擊「分析功法效益」
2. 驗證：
   - [ ] 表格顯示所有功法
   - [ ] 性價比計算正確
   - [ ] 推薦度評級正確
   - [ ] 按性價比降序排列

---

## 🔍 調試技巧

### 如果時期進度模擬仍然顯示 undefined

1. **檢查控制台**
   ```javascript
   // 應該看到：
   載入的時期數據: Array(12)
     0: {eraId: 1, name: "練氣期", ...}
     1: {eraId: 2, name: "築基期", ...}
     ...
   ```

2. **檢查數據結構**
   - 打開控制台
   - 輸入：`EraManager.getAllEras()`
   - 查看返回的數組結構

3. **檢查 CSV 文件**
   - 確認 `src/data/Eras.csv` 存在
   - 確認第一欄是 `id`（會被轉換為 `eraId`）

---

### 如果資源上限計算器仍然顯示相同內容

1. **檢查控制台**
   ```javascript
   // 在計算時應該看到：
   era.up_capacity: "lingli_max:500"
   eraCapacityRequirements: {lingli: 500}
   ```

2. **手動測試解析**
   - 打開控制台
   - 輸入：
     ```javascript
     const era = EraManager.getEraById(3);
     console.log(era.up_capacity);
     ```
   - 應該看到：`"lingli_max:10000,stone_max:5000"`

---

## 📊 預期數據參考

### 時期壽元數據
```
時期1：80 年（1.33 小時）
時期2：280 年累計（4.67 小時累計）
時期3：580 年累計（9.67 小時累計）
時期4：980 年累計（16.33 小時累計）
時期5：1480 年累計（24.67 小時累計）
時期6：2080 年累計（34.67 小時累計）
時期7：2780 年累計（46.33 小時累計）
時期8：3580 年累計（59.67 小時累計）
時期9：4480 年累計（74.67 小時累計）
時期10：5480 年累計（91.33 小時累計）
時期11：6580 年累計（109.67 小時累計）
時期12：7880 年累計（131.33 小時累計）
```

### 資源容量要求
```
時期1：lingli_max:500
時期2：lingli_max:2000, stone_max:1000
時期3：lingli_max:10000, stone_max:5000
時期4：lingli_max:50000, stone_max:20000, money_max:10000
時期5：lingli_max:200000, stone_max:100000
時期6：lingli_max:1000000
時期7：lingli_max:5000000
時期8：lingli_max:20000000
時期9：lingli_max:100000000
時期10：lingli_max:500000000
時期11：lingli_max:2000000000
時期12：lingli_max:10000000000
```

---

## ✨ 修復總結

| 問題 | 狀態 | 修復內容 |
|------|------|----------|
| 時期顯示 undefined | ✅ 已修復 | era.id → era.eraId |
| 計算結果都相同 | ✅ 已修復 | 使用正確的 eraId 進行計算 |
| 資源要求不變 | ✅ 已修復 | 解析 up_capacity 欄位 |
| 缺少達標判斷 | ✅ 已增強 | 新增達標狀態顯示 |

所有功能現已正常運作！🎉
