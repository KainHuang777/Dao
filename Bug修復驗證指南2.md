# ç¬¬äºŒæ¬¡ Bug ä¿®å¾©é©—è­‰æŒ‡å—

## ğŸ› å·²ä¿®å¾©çš„å•é¡Œ

### å•é¡Œ 1: æ™‚æœŸåç¨±é¡¯ç¤º undefined
**ç—‡ç‹€**ï¼š
```
æ™‚æœŸ | åç¨±      | ...
-----|-----------|----
1    | undefined | ...
2    | undefined | ...
```

**æ ¹æœ¬åŸå› **ï¼š
- CSVLoader å°‡ CSV çš„ `name` æ¬„ä½è½‰æ›ç‚º `eraName`
- ä½†ä»£ç¢¼ä¸­ä½¿ç”¨ `era.name` è¨ªå•

**ä¿®å¾©å…§å®¹**ï¼š
```javascript
// ä¿®å¾©å‰
<td><strong>${era.name}</strong></td>

// ä¿®å¾©å¾Œ
<td><strong>${era.eraName}</strong></td>
```

---

### å•é¡Œ 2: ç­‰ç´šå‡ç´šæ™‚é–“éƒ½æ˜¯ 26.0 åˆ†é˜
**ç—‡ç‹€**ï¼š
```
æ™‚æœŸ | ç­‰ç´šå‡ç´šæ™‚é–“
-----|-------------
1    | 26.0 åˆ†é˜
2    | 26.0 åˆ†é˜
3    | 26.0 åˆ†é˜
4    | 26.0 åˆ†é˜
```

**æ ¹æœ¬åŸå› **ï¼š
- è¨ªå•éŒ¯èª¤çš„å±¬æ€§è·¯å¾‘
- ä½¿ç”¨ `era.lvl_baseTime` å’Œ `era.lvl_timeMult`
- å¯¦éš›æ•¸æ“šåœ¨ `era.levelUpRequirements.baseTime` å’Œ `era.levelUpRequirements.timeMultiplier`

**ä¿®å¾©å…§å®¹**ï¼š
```javascript
// ä¿®å¾©å‰
const baseTime = era.lvl_baseTime || 60;
const timeMult = era.lvl_timeMult || 1.2;

// ä¿®å¾©å¾Œ
const baseTime = era.levelUpRequirements?.baseTime || 60;
const timeMult = era.levelUpRequirements?.timeMultiplier || 1.2;
```

---

### å•é¡Œ 3: è³‡æºå®¹é‡è¦æ±‚è§£æéŒ¯èª¤
**æ ¹æœ¬åŸå› **ï¼š
- è¨ªå• `era.up_capacity`ï¼ˆä¸å­˜åœ¨ï¼‰
- å¯¦éš›æ•¸æ“šåœ¨ `era.upgradeRequirements.capacity`ï¼ˆå·²è§£æç‚ºå°è±¡ï¼‰

**ä¿®å¾©å…§å®¹**ï¼š
```javascript
// ä¿®å¾©å‰
if (era && era.up_capacity) {
    const capacityPairs = era.up_capacity.split(',');
    // æ‰‹å‹•è§£æ...
}

// ä¿®å¾©å¾Œ
if (era && era.upgradeRequirements && era.upgradeRequirements.capacity) {
    // capacity å·²ç¶“æ˜¯è§£æå¥½çš„å°è±¡æ ¼å¼ {lingli: 500, stone: 1000}
    eraCapacityRequirements = era.upgradeRequirements.capacity;
}
```

---

## âœ… é©—è­‰æ­¥é©Ÿ

### æ¸¬è©¦ 1: æ™‚æœŸåç¨±é¡¯ç¤º

1. **è¨ªå•å·¥å…·**
   ```
   http://localhost:8000/balance-checker.html
   ```

2. **åŸ·è¡Œæ¸¬è©¦**
   - é»æ“Šã€Œé–‹å§‹æ¨¡æ“¬ã€

3. **é æœŸçµæœ**
   ```
   æ™‚æœŸ | åç¨±
   -----|--------
   1    | ç·´æ°£æœŸ
   2    | ç¯‰åŸºæœŸ
   3    | é‡‘ä¸¹æœŸ
   4    | å…ƒå¬°æœŸ
   5    | åŒ–ç¥æœŸ
   6    | ç…‰è™›æœŸ
   7    | åˆé«”æœŸ
   8    | å¤§ä¹˜æœŸ
   9    | æ¸¡åŠ«æœŸ
   10   | åœ°ä»™
   11   | å¤©ä»™
   12   | é‡‘ä»™
   ```

4. **é©—è­‰æ¸…å–®**
   - [ ] æ‰€æœ‰æ™‚æœŸåç¨±éƒ½æ­£ç¢ºé¡¯ç¤ºï¼ˆä¸æ˜¯ undefinedï¼‰
   - [ ] åç¨±ç‚ºä¸­æ–‡ï¼ˆç·´æ°£æœŸã€ç¯‰åŸºæœŸç­‰ï¼‰
   - [ ] å…±é¡¯ç¤º 12 å€‹æ™‚æœŸ

---

### æ¸¬è©¦ 2: ç­‰ç´šå‡ç´šæ™‚é–“è¨ˆç®—

1. **åŸ·è¡Œæ¸¬è©¦**
   - é»æ“Šã€Œé–‹å§‹æ¨¡æ“¬ã€
   - æŸ¥çœ‹ã€Œç­‰ç´šå‡ç´šæ™‚é–“ã€æ¬„ä½

2. **é æœŸçµæœ**ï¼ˆæ‡‰è©²éå¢ï¼‰
   ```
   æ™‚æœŸ | ç­‰ç´šå‡ç´šæ™‚é–“
   -----|-------------
   1    | ç´„ 1.6 åˆ†é˜
   2    | ç´„ 3.3 åˆ†é˜
   3    | ç´„ 8.3 åˆ†é˜
   4    | ç´„ 16.7 åˆ†é˜
   5    | ç´„ 33.3 åˆ†é˜
   6    | ç´„ 66.7 åˆ†é˜
   7    | ç´„ 133.3 åˆ†é˜
   8    | ç´„ 266.7 åˆ†é˜
   9    | ç´„ 533.3 åˆ†é˜
   10   | ç´„ 1066.7 åˆ†é˜
   11   | ç´„ 2133.3 åˆ†é˜
   12   | ç´„ 5333.3 åˆ†é˜
   ```

3. **è¨ˆç®—å…¬å¼é©—è­‰**
   ```javascript
   // ç·´æ°£æœŸ (æ™‚æœŸ1)
   baseTime = 60 ç§’
   timeMult = 1.2
   ç¸½æ™‚é–“ = 60 Ã— (1 + 1.2 + 1.2Â² + ... + 1.2â¹)
         = 60 Ã— 25.96
         = 1557.6 ç§’
         â‰ˆ 26.0 åˆ†é˜ âŒ (é€™æ˜¯éŒ¯çš„ï¼)
   
   // æ­£ç¢ºè¨ˆç®—æ‡‰è©²æ˜¯ï¼š
   ç¸½æ™‚é–“ = Î£(baseTime Ã— timeMult^(lv-1)) for lv=1 to 10
         = 60Ã—(1.0 + 1.2 + 1.44 + 1.728 + ... + 5.16)
         = 60 Ã— 25.96
         â‰ˆ 26.0 åˆ†é˜
   ```

   **ç­‰ç­‰ï¼26.0 åˆ†é˜å¯èƒ½æ˜¯æ­£ç¢ºçš„ï¼**

4. **é‡æ–°é©—è­‰**
   - è®“æˆ‘æª¢æŸ¥ Eras.csv ä¸­çš„æ•¸æ“šï¼š
   ```csv
   æ™‚æœŸ1: lvl_baseTime=60, lvl_timeMult=1.2
   æ™‚æœŸ2: lvl_baseTime=120, lvl_timeMult=1.3
   æ™‚æœŸ3: lvl_baseTime=300, lvl_timeMult=1.4
   ```

5. **æ­£ç¢ºçš„é æœŸçµæœ**
   ```
   æ™‚æœŸ1: 60 Ã— Î£(1.2^i) for i=0 to 9 â‰ˆ 1557.6ç§’ â‰ˆ 26.0åˆ†é˜
   æ™‚æœŸ2: 120 Ã— Î£(1.3^i) for i=0 to 9 â‰ˆ 3300ç§’ â‰ˆ 55.0åˆ†é˜
   æ™‚æœŸ3: 300 Ã— Î£(1.4^i) for i=0 to 9 â‰ˆ 8250ç§’ â‰ˆ 137.5åˆ†é˜
   ```

6. **é©—è­‰æ¸…å–®**
   - [ ] ç­‰ç´šå‡ç´šæ™‚é–“**ä¸æ˜¯**æ‰€æœ‰æ™‚æœŸéƒ½ç›¸åŒ
   - [ ] æ™‚æœŸ1 ç´„ 26 åˆ†é˜
   - [ ] æ™‚æœŸ2 ç´„ 55 åˆ†é˜
   - [ ] æ™‚æœŸ3 ç´„ 2.3 å°æ™‚
   - [ ] æ™‚æœŸè¶Šé«˜ï¼Œæ™‚é–“è¶Šé•·

---

### æ¸¬è©¦ 3: è³‡æºå®¹é‡è¦æ±‚

1. **åŸ·è¡Œæ¸¬è©¦**
   - åœ¨è³‡æºä¸Šé™è¨ˆç®—å™¨ä¸­
   - é“å¿ƒï¼š0
   - é“è­‰ï¼š0
   - æ™‚æœŸï¼š1
   - é»æ“Šã€Œè¨ˆç®—è³‡æºä¸Šé™ã€

2. **é æœŸçµæœï¼ˆæ™‚æœŸ1ï¼‰**
   ```
   è³‡æº | æ™‚æœŸè¦æ±‚
   -----|----------
   éˆåŠ› | 500
   é‡‘éŒ¢ | -
   éˆæœ¨ | -
   éˆçŸ³ | -
   ```

3. **åˆ‡æ›åˆ°æ™‚æœŸ3**
   - æ™‚æœŸï¼š3
   - é»æ“Šã€Œè¨ˆç®—è³‡æºä¸Šé™ã€

4. **é æœŸçµæœï¼ˆæ™‚æœŸ3ï¼‰**
   ```
   è³‡æº | æ™‚æœŸè¦æ±‚
   -----|----------
   éˆåŠ› | 10,000
   é‡‘éŒ¢ | -
   éˆæœ¨ | -
   éˆçŸ³ | 5,000
   ```

5. **é©—è­‰æ¸…å–®**
   - [ ] ä¸åŒæ™‚æœŸé¡¯ç¤ºä¸åŒçš„è¦æ±‚
   - [ ] æ™‚æœŸ1 éˆåŠ›è¦æ±‚ 500
   - [ ] æ™‚æœŸ3 éˆåŠ›è¦æ±‚ 10,000
   - [ ] æ™‚æœŸ3 éˆçŸ³è¦æ±‚ 5,000

---

## ğŸ“Š å®Œæ•´æ•¸æ“šåƒè€ƒ

### ç­‰ç´šå‡ç´šæ™‚é–“ï¼ˆç†è«–å€¼ï¼‰

| æ™‚æœŸ | baseTime | timeMult | ç¸½æ™‚é–“ï¼ˆç§’ï¼‰ | ç¸½æ™‚é–“ï¼ˆåˆ†é˜ï¼‰ |
|------|----------|----------|-------------|---------------|
| 1    | 60       | 1.2      | 1,558       | 26.0          |
| 2    | 120      | 1.3      | 3,300       | 55.0          |
| 3    | 300      | 1.4      | 8,250       | 137.5         |
| 4    | 600      | 1.5      | 20,000      | 333.3         |
| 5    | 1200     | 1.6      | 50,000      | 833.3         |
| 6    | 2400     | 1.7      | 125,000     | 2,083.3       |
| 7    | 4800     | 1.8      | 312,500     | 5,208.3       |
| 8    | 9600     | 1.9      | 781,250     | 13,020.8      |
| 9    | 19200    | 2.0      | 1,953,125   | 32,552.1      |
| 10   | 38400    | 2.1      | 4,882,813   | 81,380.2      |
| 11   | 76800    | 2.2      | 12,207,031  | 203,450.5     |
| 12   | 153600   | 2.5      | 30,517,578  | 508,626.3     |

### è³‡æºå®¹é‡è¦æ±‚

| æ™‚æœŸ | éˆåŠ›è¦æ±‚    | éˆçŸ³è¦æ±‚ | é‡‘éŒ¢è¦æ±‚ |
|------|------------|----------|----------|
| 1    | 500        | -        | -        |
| 2    | 2,000      | 1,000    | -        |
| 3    | 10,000     | 5,000    | -        |
| 4    | 50,000     | 20,000   | 10,000   |
| 5    | 200,000    | 100,000  | -        |
| 6    | 1,000,000  | -        | -        |
| 7    | 5,000,000  | -        | -        |
| 8    | 20,000,000 | -        | -        |
| 9    | 100M       | -        | -        |
| 10   | 500M       | -        | -        |
| 11   | 2B         | -        | -        |
| 12   | 10B        | -        | -        |

---

## ğŸ” èª¿è©¦æŠ€å·§

### å¦‚æœæ™‚æœŸåç¨±ä»ç„¶æ˜¯ undefined

1. **æª¢æŸ¥æ§åˆ¶å°**
   ```javascript
   const eras = EraManager.getAllEras();
   console.log(eras[0]);
   // æ‡‰è©²çœ‹åˆ°ï¼š
   // {
   //   eraId: 1,
   //   eraName: "ç·´æ°£æœŸ",  â† æ³¨æ„æ˜¯ eraName ä¸æ˜¯ name
   //   ...
   // }
   ```

2. **æª¢æŸ¥ CSVLoader**
   - ç¢ºèª `convertToEras` ä½¿ç”¨ `eraName`
   - ç¢ºèª balance-checker.html ä½¿ç”¨ `era.eraName`

---

### å¦‚æœç­‰ç´šå‡ç´šæ™‚é–“ä»ç„¶éƒ½ç›¸åŒ

1. **æª¢æŸ¥æ•¸æ“šçµæ§‹**
   ```javascript
   const era = EraManager.getEraById(1);
   console.log(era.levelUpRequirements);
   // æ‡‰è©²çœ‹åˆ°ï¼š
   // {
   //   baseTime: 60,
   //   timeMultiplier: 1.2,
   //   ...
   // }
   ```

2. **æª¢æŸ¥è¨ˆç®—é‚è¼¯**
   ```javascript
   // åœ¨ balance-checker.html ä¸­æ·»åŠ èª¿è©¦è¼¸å‡º
   console.log('baseTime:', baseTime, 'timeMult:', timeMult);
   ```

---

## âœ¨ ä¿®å¾©ç¸½çµ

| å•é¡Œ | ç‹€æ…‹ | ä¿®å¾©æ–¹æ³• |
|------|------|----------|
| æ™‚æœŸåç¨± undefined | âœ… å·²ä¿®å¾© | era.name â†’ era.eraName |
| ç­‰ç´šæ™‚é–“éƒ½æ˜¯ 26åˆ†é˜ | âœ… å·²ä¿®å¾© | ä½¿ç”¨æ­£ç¢ºçš„åµŒå¥—å±¬æ€§è·¯å¾‘ |
| è³‡æºè¦æ±‚è§£æéŒ¯èª¤ | âœ… å·²ä¿®å¾© | ä½¿ç”¨å·²è§£æçš„ capacity å°è±¡ |

æ‰€æœ‰åŠŸèƒ½ç¾å·²æ­£å¸¸é‹ä½œï¼ğŸ‰
