[2026-01-07 01:45] Feature & Localization: Refined Realm Hints & I18n Cleanup
1. Refined Realm Hints: Redesigned immediate and periodic hints for Eras 1-4 to be more actionable and accurate across all languages.
2. MainView.js: Refactored `checkGameHints` to use semantic i18n keys instead of hardcoded strings.
3. Era 4 Logic: Unified Era 4 entry and periodic hints to use `hint_era_4` key for consistency.
4. I18n Resolution: Cleaned up `en.json` and `ja.json` to resolve duplicate key errors and unified terminology (e.g., Skill Points).
5. Localization: Ensured all hint keys (hint_era_1~4, hint_lifespan_warning, hint_reincarnation_periodic) are available and consistent in all i18n files.

[2026-01-07 01:35] I18n Optimization: Skill Requirements
1. Added I18n support for skill requirements in realm/level-up tooltips.
2. Refactored `EraManager.js` to prioritize skill IDs for translation, falling back to names from CSV.
3. Added mapping for all skill IDs in `zh-TW.json`, `zh-CN.json`, `en.json`, and `ja.json`.

[2026-01-07 01:30] I18n Optimization: Resource & Player Info
1. Added missing translations for "Cultivation Progress" (修練進度), "Mid-grade Spirit Stone", "Pill Liquid", and "Talisman" across all languages.
2. Refactored `ResourcePanel` and `CraftingPanel` to prioritize Resource ID for translation, ensuring consistent display even with emojis in CSV data.
3. Updated `EraManager._getResName` to include missing resource IDs (liquid, talisman).
4. Synchronized `zh-TW.json` with base keys to ensure fallback consistency.

[2026-01-07 01:25] Documentation: Synced & Updated Release Notes v0.21
1. ReleaseNotes.js: Added missing features to v0.21 notes across all languages (zh-TW, zh-CN, en, ja).
2. Added items: Resource deduction logs [DEV], Pill consumption limits (limits per realm, 100% cap), Cultivation UI visualization (Progress bar, Hover tooltips), and Version display fix.
3. Consistency: Ensured all 4 languages have identical 9 items for v0.21 to prevent display discrepancies.

[2026-01-07 01:20] Fix: Initial Version Number Display
1. MainView.js: Updated `updateStaticText` to initialize the version button and ID from `ReleaseNotes[0]` immediately upon game start.
2. Rationale: Fixed the issue where the version number displayed an outdated "0.20" until the version modal was opened.

[2026-01-07 01:15] Fix: Dynamic Progress Bar & Tooltip Flickering
1. MainView.js: Enabled real-time updates for the training progress bar and percentage text in `updatePlayerStatus`.
2. MainView.js: Removed time-based "reason" from the level-up button title (Tooltip) to stop the constant flickering caused by ticking seconds.
3. UI Logic: Now the Tooltip focus on resource requirements (updated less frequently), while the progress bar handles cultivation time visualization.

[2026-01-07 01:05] UI: Level-Up Button Tooltip & Training Progress Bar
1. MainView.js: Level-up button tooltip now shows resource requirements with current/required values and checkmarks.
2. MainView.js: Added a training progress bar (75% width) below the level-up button to show cultivation progress.
3. i18n: Added "修練進度" key to zh-TW.json.
4. Rationale: This avoids tooltip flickering due to constantly updating time values.

[2026-01-07 01:00] Feature: Resource Deduction Log & Pill Consumption Limits
1. PlayerManager.js:
   - Added logic to `increaseLevel` to deduct resources (previously only checked).
   - Added [DEV] tag log for deducted resources when leveling up.
   - Updated `consumePill` to block tribulation pills if success rate >= 100%.
   - Updated `consumePill` to limit tribulation pill count based on current Era (e.g., Era 4 can take 4 pills).
   - Updated pill consumption log to show the new total tribulation success rate.
2. i18n: Added translation keys for new logs and error messages in zh-TW.

[2026-01-06 23:58] Balance & UX: Pill Logic and Era 2 Requirements
1. eras.csv: Changed Era 2 (Foundation Establishment) level up requirement from "Mid-grade Spirit Stone x10" to "Low-grade Spirit Stone x50", as Mid-grade stones are not craftable at this stage.
2. PlayerManager.js: Added restriction to prevent consuming pills with 'tribulationSuccess' effect (e.g., Foundation Pill) when Era < 3 (Golden Core).
3. PlayerManager.js: Updated pill effect description to show "(Current realm cannot consume)" if the restriction applies.
4. i18n: Added translation for restriction message.

[2026-01-06 23:55] Feature: Enhanced Level Up Button tooltips
1. EraManager.js: Refactored checkLevelUpRequirements to provide detailed feedback when resources are insufficient. It now lists specific missing resource names and amounts.
2. i18n: Added "資源不足: 需要 {res}" template and resource names to zh-TW.json.
3. Result: Hovering over disabled "Upgrade" button in Player Info now clearly shows exactly what's missing.

[2026-01-06 23:48] Fix: Level up button UI/logic inconsistency
1. EraManager.js: Fixed checkLevelUpRequirements to correctly read .value from resource objects. Previously, it compared resource objects directly with numbers, leading to logic failure.
2. MainView.js: Unified resource source to getUnlockedResources() for both level-up button click and UI updates.
3. Result: Level up button now correctly reflects the satisfied status of resources and training time.

[2026-01-06 23:45] Fix: Realm hint display error in zh-TW
1. LanguageManager.js: Removed zh-TW special case. Now loads zh-TW.json like other languages.
2. zh-TW.json: Created new translation file containing hint_era_1~4 and other ID-based keys.
3. Rationale: Fixed issue where "hint_era_2" ID was shown instead of translated text in TC.

[2026-01-06 23:23] Balance: Dantian Expansion Skill Cost Adjustment
1. skills.csv: Reduced core_expansion_1 cost from 10800 to 9000.
2. skills.csv: Reduced core_expansion_2 cost from 18000 to 15000.
3. skills.csv: Reduced core_expansion_3 cost from 30000 to 24000.
4. Rationale: Ensure skills are attainable within Golden Core era with Scripture Hall upgrades, without requiring more than 5 reincarnations.

[2026-01-06 23:18] ReleaseNotes v0.21 補齊
1. ReleaseNotes.js: Added missing entries for v0.21 to match update.txt 2026-01-06 changes.
2. Added: Language switcher revamped (flat button layout with browser language detection).
3. Added: Multilingual support expanded (Release Notes multilingual, pill/skill descriptions translatable).
4. Added: Cultivation system enhanced (level bonuses, prerequisite skills at LV5+, LV9 items).
5. Added: New reincarnation talent "Celestial Cycle Expansion" (+10% skill point cap).

[2026-01-06 23:05] Gameplay Hint System Upgrade
1. PlayerManager.js: Added `shownEraHints` to player state to track displayed realm hints.
2. MainView.js: Implemented immediate hints upon entering a new realm (Era 1-4).
3. MainView.js: Redesigned early game hints to guide players on specific actions (upgrading storage, crafting pills, preparing for tribulation, or reincarnating) to prevent soft-locks.
4. i18n: Added multi-language support (zh-CN, en, ja) for all new realm hints.

[2026-01-06 22:40] Localization & Release Notes Update
1. PlayerManager.js: Replaced hardcoded Spirit Nurturing Pill effect description with translatable key '服用蘊靈丹效果'.
2. HelpPanel.js: Replaced hardcoded Skills section description with translatable key '功法說明內容'.
3. ReleaseNotes.js: Refactored data structure to support multilingual notes (zh-TW, zh-CN, en, ja).
4. MainView.js: Updated Release Notes modal to display notes based on current language.
5. i18n: Added missing translations for pill effects and help text to all language files.

[2026-01-06 22:30] Language Switcher Enhancements
1. MainView.js: Added detectBrowserLanguage() method to detect browser's language preference.
2. MainView.js: Refactored initLanguageSwitcher() from dropdown to flat button layout (EN/TC/SC/JP).
3. Language switcher now displays detected browser language code above buttons, highlighted in gold if different from current selection.
4. Selected language button uses gradient style similar to reincarnation talent levels (purple gradient with glow effect).
5. Unselected buttons have dark background with hover effects for better UX.

[2026-01-06 22:10] Cultivation System Enhancements
1. eras.csv: Moved upgrade prerequisite skills (up_skills) to level-up skills (lvl_skills) triggered at LV5.
2. eras.csv: Added stone_mid consumption (lvl_res3) for Era 2+, and special crafted item consumption (lv9_item) for LV9.
3. skills.csv: Changed core_expansion skills effect from all_max to skill_point_max.
4. CSVLoader.js: Extended convertToEras() to parse new CSV columns (lvl_res3, lv9_item) and support pipe-delimited skills.
5. EraManager.js: Modified checkLevelUpRequirements() to only check skills at LV5+, and added LV9 item consumption logic.
6. PlayerManager.js: Added getLevelProductionBonus() (+1% per level), getLevelSkillPointCapBonus() (+1% per 5 levels), and cycle_expansion talent support.
7. BuildingManager.js: Applied level production bonus, skill_point_max handling, and cycle_expansion talent to recalculateRates().
8. TalentPanel.js: Added new reincarnation talent "周天循環·擴" (Celestial Cycle Expansion) for +10% skill point cap.
9. i18n (zh-CN, en, ja): Added translations for new talent and updated skill descriptions.

[2026-01-05 23:08] ReleaseNotes Refactoring
1. ReleaseNotes.js: Restructured into a list of versions, with newest updates at the top and explicit version/date headers.
2. MainView.js: Updated rendering logic to display multiple version logs with clear separators and historical dates.

[2026-01-05 23:05] Release Notes System
1. Created ReleaseNotes.js: Condensed recent updates for players (v0.2.0).
2. index.html: Added version button (v0.2.0) next to save/load buttons and a dedicated update log modal.
3. MainView.js: Implemented logic to display release notes modal and update version display.

[2026-01-05 22:55] Debug Panel Fixes
1. DebugPanel.js: Updated "Max Era Level" (時期等級全滿) to correctly update the unified save system (`saveToStorage`) and set training time to prevent "Time Required" display issues.
2. Fixed a synchronization bug where debug actions were being overwritten by the unified save on reload.

[2026-01-05 22:50] Unified Save/Load System & Test Page Update
1. SaveSystem.js: Unified player state (Era, Level, Skills, etc.) with resources and buildings into a single save file.
2. PlayerManager.js: Added exportData() and loadData() for unified saving.
3. core-test.html: Added a dedicated section for Save/Load testing, allowing generation and reading of save codes and storage.
4. MainView.js: Fixed manual loading to include all data components and trigger a page reload for state consistency.
5. Fixed: Save codes now correctly persist all player progress.

[2026-01-05 22:35] Added "Help" page & Fixed crash
1. index.html: Added missing "view-help" container and "Help" tab button.
2. HelpPanel.js: Created new component for displaying game instructions and developer information.
3. MainView.js: Integrated HelpPanel into UIManager and updated tab naming logic.
4. i18n: Added translations for Help page content (zh-TW, zh-CN, en, ja).
5. Fixed: TypeError in HelpPanel when container was missing.

[2026-01-05 21:59] 煉製合成功能優化
1. CraftingPanel.js: 新增 refresh() 方法並重新渲染介面，確保分頁切換時數據與批量按鈕是最新的。
2. CraftingPanel.js: 修復 updateEntry() 覆蓋丹藥資訊的問題，並在 updateButtons() 循環中加入數據同步更新，保證背景資源增長時按鈕能動態啟用。
3. MainView.js: 註冊 'crafting' 分頁切換回調。

[2026-01-05 21:45] Add Google Analytics
1. index.html: Added Google Analytics tag (gtag.js) to the head section for usage tracking.

[2026-01-04 23:40] 靈藥持久時間與 Buff 系統
1. PlayerManager：新增 activeBuffs 處理多個藥效緩衝。
2. PlayerManager：實作 cleanExpiredBuffs() 自動清除過期 buff。
3. PlayerManager：實作 getLingliBuffMultiplier() 注入靈力加成。
4. PlayerManager：修改 consumePill() 以支持不同丹藥效果，增加 buff + 增加修煉時間。
5. BuildingManager：計算產出時考慮 buff 加成。
6. Resources.js：修正對 LanguageManager 調用的錯誤（補充 import）。

靈藥具體數值如下：
- 蘊靈丹效果：靈力產出 2倍，持續 1年 (60秒)。
- 增加總修煉時間 1年。
- Buff 結束後會自動恢復正常產出。

[2026-01-04 23:25] 靈藥系系統：新增蘊靈丹及其效果
1. 靈藥系系統：10% 概率產出 2倍，5% 概率產出 3倍，並標示於煉製界面。
2. 蘊靈丹效果：立即增加修煉產出 2倍持續 1年，增加修煉時間 1年（數值暫定，buff 系統後續實作）。
3. 界面優化：修正靈藥煉製界面顯示，使其與普通資源煉製界面對齊。

[2026-01-04 23:05] 修復：CraftingPanel 區域變量使用錯誤
修復 effectDiv 變量在 if 塊外部使用导致的 ReferenceError。
將 effectDiv 定義移動到外部使用，並保證其在條件不滿足時為空。

[2026-01-04 21:50] 介面優化：修煉進度條顯示功能
1. 進度條：增加對等級提昇時間的進度顯示，數值顯示在進度條中央。
2. 介面寬度：容器寬度調整，避免文字超出。
3. 修煉時長：優化顯示格式（nfo -> info）。

[2026-01-04 21:40] 數值驗證：更新 Build 版本
1. index.html: 更新版本號標籤顯示 2026-01-04 21:40:00
請強制刷新瀏覽器 (Ctrl+Shift+R) 並打開開發者工具查看 Console。  
服用蘊靈丹後應該看到時間戳變化的日誌。  
 
[2026-01-05 00:10] 術語調整：遊戲時間單位改為「祀」  
將所有顯示「年」的地方改為「祀」以區分遊戲時間與現實時間。  
修改位置：  
1. EraManager.js: 修練時間不足提示  
2. PlayerManager.js: 蘊靈丹效果描述  
3. CraftingPanel.js: 丹藥效果文字  
4. 翻譯文件: en.json (si), ja.json (祀), zh-CN.json (祀)  
  
[2026-01-05 00:05] 調試：暴露 PlayerManager 到 window  
添加 window.PlayerManager 以便在 Console 中調試。  
確認蘊靈丹功能完全正常：時間戳修改成功，修煉時間正確增加。  
 
 
[2026-01-05 00:45] Fix: Pill effect display and Time Unit
- 2026-01-05: Added "Help" page with game instructions, system explanations, and multilingual support.
- 2026-01-05: Optimized Crafting Panel to refresh resources and button states correctly when switching tabs.
1. EraManager.js: Updated checkLevelUpRequirements to display 'remaining time' instead of 'total required time' when training time is insufficient. This allows the player to see the impact of Spirit Accumulation Pill (which adds cultivation time) as a reduction in remaining time.
2. zh-CN.json: Changed the translation of 'Year' (年) to 'Si' (祀) and updated the insufficient time message to 'Still need {years} Si'.


[2026-01-05 00:54] Fix: getLevelUpRequiredTime logic in EraManager
1. EraManager.js: Fixed getLevelUpRequiredTime logic to use (currentLevel - 1) as exponent, matching the level sequence index (0-based for Level 1). This ensures the returned required time matches the Cumulative Time Threshold for Level 1, aligning with verify logic in checkLevelUpRequirements.
2. Verified unit change in UI via code reviews (Year -> Si).


[2026-01-05 01:10] Fix: Log params interpolation
1. LanguageManager.js: Although the code was correct, confirmed logic for parameter replacement. It uses {0} format or {name} format depending on t() implementation. In zh-CN.json, keys use {0}, {1}. The call in BuildingManager uses {0}, {1} too.
2. BuildingManager.js: The issue 'Building {0} upgraded to Lv.{1}' implies that {0} was NOT replaced. This usually happens if the translation key in JSON uses different placeholders OR if the passed params object key doesn't match.
   Key in zh-CN: '建築 <b>{0}</b> 升級至 Lv.{1}' (needs checking JSON file)
   Code: t('建築 <b>{0}</b> 升級至 Lv.{1}', { '0': ..., '1': ... })
   If zh-TW (default), logic does replace params.
   If zh-CN, logic does replace params IF translated string has {0}, {1}.
   
   Potential cause: The 'zh-CN.json' file might NOT have the key '建築 <b>{0}</b> 升級至 Lv.{1}' exactly, or it might have different placeholders. I should check zh-CN.json for this specific key.
